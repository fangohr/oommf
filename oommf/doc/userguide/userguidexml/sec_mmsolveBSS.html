<!DOCTYPE html><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>10.2.2 2D Micromagnetic Solver Batch Scheduling System‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide</title>
<!--Generated by LaTeXML (version 0.8.6) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on September 30, 2022.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="oommf.css" type="text/css">
<link rel="stylesheet" href="oommf-report.css" type="text/css">
<link rel="stylesheet" href="oommf-tweakfonts.css" type="text/css">
<link rel="stylesheet" href="oommf-navbar.css" type="text/css">
<script src="LaTeXML-maybeMathjax.js" type="text/javascript"></script>
<link rel="up" href="sec_obs.html" title="10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="up up" href="sec_mmsolve.html" title="Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="up up up" href="userguide.html" title="OOMMF User’s Guide">
<link rel="start" href="userguide.html" title="OOMMF User’s Guide">
<link rel="prev" href="sec_batchsolve.html" title="10.2.1 2D Micromagnetic Solver Batch Interface: batchsolve ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="next" href="sec_mmdatatable.html" title="Chapter 11 Data Table Display: mmDataTable ‣ OOMMF User’s Guide">
<link rel="subsection" href="sec_batchsolve.html" title="10.2.1 2D Micromagnetic Solver Batch Interface: batchsolve ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="section" href="sec_mmsolve2d.html" title="10.1 The 2D Micromagnetic Interactive Solver: mmSolve2D ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="section" href="sec_obs.html" title="10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="chapter" href="disclaimer.html" title="Disclaimer ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_overview.html" title="Chapter 1 Overview of OOMMF ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_install.html" title="Chapter 2 Installation ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_quickstart.html" title="Chapter 3 Quick Start: Example OOMMF Session ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_arch.html" title="Chapter 4 OOMMF Architecture Overview ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_cll.html" title="Chapter 5 Command Line Launching ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmlaunch.html" title="Chapter 6 OOMMF Launcher/Control Interface: mmLaunch ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_oxs.html" title="Chapter 7 OOMMF eXtensible Solver ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmprobed.html" title="Chapter 8 Micromagnetic Problem Editor: mmProbEd ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_filesource.html" title="Chapter 9 Micromagnetic Problem File Source: FileSource ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmsolve.html" title="Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmdatatable.html" title="Chapter 11 Data Table Display: mmDataTable ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmgraph.html" title="Chapter 12 Data Graph Display: mmGraph ‣ OOMMF User’s Guide">
<link rel="chapter" href="html_mmdispdatascale.html" title="Chapter 13 Vector Field Display: mmDisp ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmarchive.html" title="Chapter 14 Data Archive: mmArchive ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mmhelp.html" title="Chapter 15 Documentation Viewer: mmHelp ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_cmdutils.html" title="Chapter 16 Command Line Utilities ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_mifformat.html" title="Chapter 17 Problem Specification File Formats (MIF) ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_odtformat.html" title="Chapter 18 Data Table File Format (ODT) ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_vfformats.html" title="Chapter 19 Vector Field File Format (OVF) ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_trouble.html" title="Chapter 20 Troubleshooting ‣ OOMMF User’s Guide">
<link rel="chapter" href="sec_credits.html" title="Chapter 21 Credits ‣ OOMMF User’s Guide">
<link rel="bibliography" href="bibliography.html" title="Bibliography ‣ OOMMF User’s Guide">
<link rel="index" href="index.html" title="Index ‣ OOMMF User’s Guide">
<meta name="keywords" lang="en" content="MIF 1.x, application, batchmaster, communication protocol, control point, data table, file, magnetization, network socket, requirement, scheduling, simulation 2D, ssh, task script, working directory">
</head>
<body>
<nav class="ltx_page_navbar"><a href="userguide.html" title="OOMMF User’s Guide" class="ltx_ref" rel="start"><span class="ltx_text ltx_ref_title">OOMMF User’s Guide</span></a>
<div class="ltx_TOC">
<ul class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="disclaimer.html" title="Disclaimer ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title">Disclaimer</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_overview.html" title="Chapter 1 Overview of OOMMF ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Overview of OOMMF</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_install.html" title="Chapter 2 Installation ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Installation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_quickstart.html" title="Chapter 3 Quick Start: Example OOMMF Session ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Quick Start: Example OOMMF Session</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_arch.html" title="Chapter 4 OOMMF Architecture Overview ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>OOMMF Architecture Overview</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_cll.html" title="Chapter 5 Command Line Launching ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Command Line Launching</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmlaunch.html" title="Chapter 6 OOMMF Launcher/Control Interface: mmLaunch ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>OOMMF Launcher/Control Interface: mmLaunch</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_oxs.html" title="Chapter 7 OOMMF eXtensible Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>OOMMF eXtensible Solver</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmprobed.html" title="Chapter 8 Micromagnetic Problem Editor: mmProbEd ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">8 </span>Micromagnetic Problem Editor: mmProbEd</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_filesource.html" title="Chapter 9 Micromagnetic Problem File Source: FileSource ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">9 </span>Micromagnetic Problem File Source: FileSource</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter">
<a href="sec_mmsolve.html" title="Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10 </span>The 2D Micromagnetic Solver</span></a>
<ul class="ltx_toclist ltx_toclist_chapter">
<li class="ltx_tocentry ltx_tocentry_section"><a href="sec_mmsolve2d.html" title="10.1 The 2D Micromagnetic Interactive Solver: mmSolve2D ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.1 </span>The 2D Micromagnetic Interactive Solver: mmSolve2D</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a href="sec_obs.html" title="10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2 </span>OOMMF 2D Micromagnetic Solver Batch System</span></a>
<ul class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a href="sec_batchsolve.html" title="10.2.1 2D Micromagnetic Solver Batch Interface: batchsolve ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.1 </span>2D Micromagnetic Solver Batch Interface: batchsolve</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection ltx_ref_self">
<span class="ltx_ref ltx_ref_self"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.2 </span>2D Micromagnetic Solver Batch Scheduling System</span></span>
<ul class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a href="#SSS1" title="10.2.2.1 Master Scheduling Control: batchmaster ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.2.1 </span>Master Scheduling Control: batchmaster</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a href="#SSS2" title="10.2.2.2 Task Control: batchslave ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.2.2 </span>Task Control: batchslave</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a href="#sec:batchschedtask" title="10.2.2.3 Batch Task Scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.2.3 </span>Batch Task Scripts</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a href="#sec:batchschedex" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.2.4 </span>Sample task scripts</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmdatatable.html" title="Chapter 11 Data Table Display: mmDataTable ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">11 </span>Data Table Display: mmDataTable</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmgraph.html" title="Chapter 12 Data Graph Display: mmGraph ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">12 </span>Data Graph Display: mmGraph</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="html_mmdispdatascale.html" title="Chapter 13 Vector Field Display: mmDisp ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">13 </span>Vector Field Display: mmDisp</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmarchive.html" title="Chapter 14 Data Archive: mmArchive ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">14 </span>Data Archive: mmArchive</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mmhelp.html" title="Chapter 15 Documentation Viewer: mmHelp ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">15 </span>Documentation Viewer: mmHelp</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_cmdutils.html" title="Chapter 16 Command Line Utilities ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">16 </span>Command Line Utilities</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_mifformat.html" title="Chapter 17 Problem Specification File Formats (MIF) ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">17 </span>Problem Specification File Formats (MIF)</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_odtformat.html" title="Chapter 18 Data Table File Format (ODT) ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">18 </span>Data Table File Format (ODT)</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_vfformats.html" title="Chapter 19 Vector Field File Format (OVF) ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">19 </span>Vector Field File Format (OVF)</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_trouble.html" title="Chapter 20 Troubleshooting ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">20 </span>Troubleshooting</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a href="sec_credits.html" title="Chapter 21 Credits ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">21 </span>Credits</span></a></li>
<li class="ltx_tocentry ltx_tocentry_bibliography"><a href="bibliography.html" title="Bibliography ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title">Bibliography</span></a></li>
<li class="ltx_tocentry ltx_tocentry_index"><a href="index.html" title="Index ‣ OOMMF User’s Guide" class="ltx_ref"><span class="ltx_text ltx_ref_title">Index</span></a></li>
</ul>
</div>
</nav>
<div class="ltx_page_main">
<header class="ltx_page_header">
<div>
<a href="sec_obs.html" title="10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref" rel="up"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2 </span>OOMMF 2D Micromagnetic Solver Batch System</span></a><a href="sec_batchsolve.html" title="10.2.1 2D Micromagnetic Solver Batch Interface: batchsolve ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.1 </span>2D Micromagnetic Solver Batch Interface: batchsolve</span></a><a href="sec_mmdatatable.html" title="Chapter 11 Data Table Display: mmDataTable ‣ OOMMF User’s Guide" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">11 </span>Data Table Display: mmDataTable</span></a>
</div></header>
<div class="ltx_page_content">
<section class="ltx_subsection ltx_authors_1line">
<h1 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">10.2.2 </span>2D Micromagnetic Solver Batch Scheduling System</h1>

<div id="p1" class="ltx_para ltx_noindent">
<p class="ltx_p"><span class="ltx_text ltx_font_bold" style="font-size:120%;">Overview
<br class="ltx_break"></span>The OBS supports complex scheduling of multiple batch jobs
with two applications, <span class="ltx_text ltx_font_bold">batchmaster</span> and <span class="ltx_text ltx_font_bold">batchslave</span>.
The user launches <span class="ltx_text ltx_font_bold">batchmaster</span> and provides it with
a task script. The task script is a
Tcl script that describes the set of tasks for <span class="ltx_text ltx_font_bold">batchmaster</span>
to accomplish. The work is actually done by instances of
<span class="ltx_text ltx_font_bold">batchslave</span> that are launched by <span class="ltx_text ltx_font_bold">batchmaster</span>.
The task script may be
modeled after the included <span class="ltx_text ltx_font_typewriter">simpletask.tcl</span> or <span class="ltx_text ltx_font_typewriter">multitask.tcl</span>
<a href="#sec:batchschedex" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">sample scripts</a>.</p>
</div>
<div id="p2" class="ltx_para">
<p class="ltx_p">The OBS has been designed to control multiple sequential and
concurrent micromagnetic simulations, but
<span class="ltx_text ltx_font_bold">batchmaster</span> and <span class="ltx_text ltx_font_bold">batchslave</span> are completely general
and may be used to schedule other types of jobs as well.
</p>
</div>
<section id="SSS1" class="ltx_subsubsection">
<h2 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">10.2.2.1 </span>Master Scheduling Control: batchmaster</h2>

<div id="SSS1.p1" class="ltx_para">
<p class="ltx_p">The application <span class="ltx_text ltx_font_bold">batchmaster</span> is
launched by the command line:</p>
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchmaster [standard options] task_script \
      [host [port]]
</pre>
<dl id="Ch10.S2.I4" class="ltx_description">
<dt id="Ch10.S2.I4.ix1" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">task_script</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I4.ix1.p1" class="ltx_para">
<p class="ltx_p">is the user defined task (job) definition Tcl script,</p>
</div>
</dd>
<dt id="Ch10.S2.I4.ix2" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">host</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I4.ix2.p1" class="ltx_para">
<p class="ltx_p">specifies the network address for the master to use (default is <span class="ltx_text ltx_font_italic">localhost</span>),</p>
</div>
</dd>
<dt id="Ch10.S2.I4.ix3" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">port</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I4.ix3.p1" class="ltx_para">
<p class="ltx_p">is the port address for the master (default is <span class="ltx_text ltx_font_italic">0</span>, which
selects an arbitrary open port).</p>
</div>
</dd>
</dl>
</div>
<div id="SSS1.p2" class="ltx_para">
<p class="ltx_p">When <span class="ltx_text ltx_font_bold">batchmaster</span> is run, it
sources the task script. Tcl commands in the task script
should modify the global object <span class="ltx_text ltx_font_typewriter">$TaskInfo</span>
to inform the master what tasks to perform and
optionally how to launch slaves to perform those tasks.
The easiest way to create a task script is to modify one of the
<a href="#sec:batchschedex" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">included example scripts</a>. More detailed instructions are in
<a href="#sec:batchschedtask" title="10.2.2.3 Batch Task Scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">Batch task
scripts</a>.</p>
</div>
<div id="SSS1.p3" class="ltx_para">
<p class="ltx_p">After sourcing the task script, <span class="ltx_text ltx_font_bold">batchmaster</span> launches all the
specified slaves, initializes each with a slave initialization script,
and then feeds tasks sequentially from the task list to the slaves.
When a slave completes a task it reports back to the master and is given
the next unclaimed task. If there are no more tasks, the slave is shut
down. When all the tasks are complete, the master prints a summary of
the tasks and exits.</p>
</div>
<div id="SSS1.p4" class="ltx_para">
<p class="ltx_p">When the task script requests the launching and controlling of jobs off
the local machine, with slaves running on remote machines, then the
command line argument <span class="ltx_text ltx_font_typewriter">host</span> <span class="ltx_text ltx_font_bold">must</span> be set to the local machine’s
network name, and the <span class="ltx_text ltx_font_typewriter">$TaskInfo</span> methods <span class="ltx_text ltx_font_typewriter">AppendSlave</span> and
<span class="ltx_text ltx_font_typewriter">ModifyHostList</span> will need to be called from inside the task script.
Furthermore, OOMMF does not currently supply any methods for launching
jobs on remote machines, so a task script which requests the launching
of jobs on remote machines requires a working
<code class="ltx_verbatim ltx_font_typewriter">ssh</code> command or
equivalent.
<a href="#sec:batchschedtask" title="10.2.2.3 Batch Task Scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">(Details.)</a>
</p>
</div>
</section>
<section id="SSS2" class="ltx_subsubsection">
<h2 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">10.2.2.2 </span>Task Control: batchslave</h2>

<div id="SSS2.p1" class="ltx_para">
<p class="ltx_p">The application <span class="ltx_text ltx_font_bold">batchslave</span> may be launched by the command line:</p>
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchslave [standard options] \
   host port id password [auxscript [arg ...]]
</pre>
<dl id="Ch10.S2.I5" class="ltx_description">
<dt id="Ch10.S2.I5.ix1" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">host, port</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I5.ix1.p1" class="ltx_para">
<p class="ltx_p">Host and port at which to contact the master to serve.</p>
</div>
</dd>
<dt id="Ch10.S2.I5.ix2" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">id, password</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I5.ix2.p1" class="ltx_para">
<p class="ltx_p">ID and password to send to the master for identification.</p>
</div>
</dd>
<dt id="Ch10.S2.I5.ix3" class="ltx_item"><span class="ltx_tag ltx_tag_item"><span class="ltx_text ltx_font_bold">auxscript arg …</span></span></dt>
<dd class="ltx_item">
<div id="Ch10.S2.I5.ix3.p1" class="ltx_para">
<p class="ltx_p">The name of an optional script to source (which actually performs the
task the slave is assigned), and any arguments it needs.</p>
</div>
</dd>
</dl>
</div>
<div id="SSS2.p2" class="ltx_para">
<p class="ltx_p">In normal operation, the user does not launch
<span class="ltx_text ltx_font_bold">batchslave</span>. Instead, instances of <span class="ltx_text ltx_font_bold">batchslave</span> are
launched by <span class="ltx_text ltx_font_bold">batchmaster</span> as instructed by a task script.
Although <span class="ltx_text ltx_font_bold">batchmaster</span> may launch any slaves requested
by its task script, by default it launches instances of
<span class="ltx_text ltx_font_bold">batchslave</span>.</p>
</div>
<div id="SSS2.p3" class="ltx_para">
<p class="ltx_p">The function of <span class="ltx_text ltx_font_bold">batchslave</span> is to make a connection to
a master program, source the <span class="ltx_text ltx_font_typewriter">auxscript</span> and pass it the
list of arguments <span class="ltx_text ltx_font_typewriter">aux_arg ...</span>. Then it receives commands
from the master, and evaluates them, making use of the
facilities provided by <span class="ltx_text ltx_font_typewriter">auxscript</span>. Each command is typically a
long-running one, such as solving a complete micromagnetic problem.
When each command is complete, the <span class="ltx_text ltx_font_bold">batchslave</span> reports back to
its master program, asking for the next command. When the master
program has no more commands <span class="ltx_text ltx_font_bold">batchslave</span> terminates.</p>
</div>
<div id="SSS2.p4" class="ltx_para">
<p class="ltx_p">Inside <span class="ltx_text ltx_font_bold">batchmaster</span>, each instance of <span class="ltx_text ltx_font_bold">batchslave</span> is
launched by evaluating a Tcl command. This command is called
the spawn command, and it may be redefined by the task script
in order to completely control which slave applications are launched
and how they are launched. When <span class="ltx_text ltx_font_bold">batchslave</span> is to be launched,
the spawn command might be:
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
exec tclsh oommf.tcl batchslave -tk 0 -- $server(host) $server(port) \
   $slaveid $passwd batchsolve.tcl -restart 1 &amp;
</pre>
</blockquote>
<p class="ltx_p">The Tcl command <span class="ltx_text ltx_font_typewriter">exec</span> is used to launch subprocesses. When
the last argument to <span class="ltx_text ltx_font_typewriter">exec</span> is <span class="ltx_text ltx_font_typewriter">&amp;</span>, the subprocess runs in
the background. The rest of the spawn command should look familiar
as the command line syntax for launching <span class="ltx_text ltx_font_bold">batchslave</span>.</p>
</div>
<div id="SSS2.p5" class="ltx_para">
<p class="ltx_p">The example spawn command above cannot be completely provided by
the task script, however, because parts of it are only known
by <span class="ltx_text ltx_font_bold">batchmaster</span>. Because of this, the task script should
define the spawn command using “percent variables” which are
substituted by <span class="ltx_text ltx_font_bold">batchmaster</span>. Continuing the example, the task
script provides the spawn command:
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
exec %tclsh %oommf batchslave -tk 0 %connect_info \
   batchsolve.tcl -restart 1
</pre>
</blockquote>
<p class="ltx_p"><span class="ltx_text ltx_font_bold">batchmaster</span> replaces <span class="ltx_text ltx_font_typewriter">%tclsh</span> with the path to <span class="ltx_text ltx_font_typewriter">tclsh</span>,
and <span class="ltx_text ltx_font_typewriter">%oommf</span> with the path to the OOMMF bootstrap application.
It also replaces <span class="ltx_text ltx_font_typewriter">%connect_info</span> with the five arguments from <code class="ltx_verbatim ltx_font_typewriter">--</code>
through <span class="ltx_text ltx_font_typewriter">$password</span> that provide <span class="ltx_text ltx_font_bold">batchslave</span>
the hostname and port where <span class="ltx_text ltx_font_bold">batchmaster</span> is waiting for
it to report to, and the ID and password it should pass back.
In this example, the task script instructs <span class="ltx_text ltx_font_bold">batchslave</span> to source the
file <span class="ltx_text ltx_font_typewriter">batchsolve.tcl</span> and pass it the arguments <span class="ltx_text ltx_font_typewriter">-restart 1</span>.
Finally, <span class="ltx_text ltx_font_bold">batchmaster</span> always appends the argument <span class="ltx_text ltx_font_typewriter">&amp;</span> to
the spawn command so that all slave applications are launched in the
background.</p>
</div>
<div id="SSS2.p6" class="ltx_para">
<p class="ltx_p">The communication protocol between
<span class="ltx_text ltx_font_bold">batchmaster</span> and <span class="ltx_text ltx_font_bold">batchslave</span> is evolving and is not
described here. Check the source code for the latest details.</p>
</div>
</section>
<section id="sec:batchschedtask" class="ltx_subsubsection">
<h2 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">10.2.2.3 </span>Batch Task Scripts</h2>

<div id="SSS3.p1" class="ltx_para">
<p class="ltx_p">The application <span class="ltx_text ltx_font_bold">batchmaster</span>
creates an instance of a <span class="ltx_text ltx_font_typewriter">BatchTaskObj</span> object with
the name <span class="ltx_text ltx_font_typewriter">$TaskInfo</span>. The task script uses
method calls to this object to set up tasks to be performed. The only
required call is to the <span class="ltx_text ltx_font_typewriter">AppendTask</span> method, e.g.,
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo AppendTask A "BatchTaskRun taskA.mif"
</pre>
</blockquote>
<p class="ltx_p">This method expects two arguments, a label for the task (here “A”) and
a script to accomplish the task.
The script will be passed across a
network socket from
<span class="ltx_text ltx_font_bold">batchmaster</span> to a slave application, and
then the script will be interpreted by the slave. In particular, keep
in mind that the file system seen by the script will be that of the
machine on which the slave process is running.</p>
</div>
<div id="SSS3.p2" class="ltx_para">
<p class="ltx_p">This example uses the default <span class="ltx_text ltx_font_typewriter">batchsolve.tcl</span> procs to run the
simulation defined by the <span class="ltx_text ltx_font_typewriter">taskA.mif</span> MIF 1.x
file. If you want to make changes to the MIF problem specifications on the fly, you will need to modify the default
procs. This is done by creating a slave initialization script, via the
call
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo SetSlaveInitScript { &lt;insert script here&gt; }
</pre>
</blockquote>
<p class="ltx_p">The slave initialization script does global initializations, and also
usually redefines the <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> proc; optionally the
<span class="ltx_text ltx_font_typewriter">BatchTaskIterationCallback</span>, <span class="ltx_text ltx_font_typewriter">BatchTaskRelaxCallback</span> and
<span class="ltx_text ltx_font_typewriter">SolverTaskCleanup</span> procs may be redefined as well. At the start of
each task <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> is called by <span class="ltx_text ltx_font_typewriter">BatchTaskRun</span> (in
<span class="ltx_text ltx_font_typewriter">batchsolve.tcl</span>), after each iteration
<span class="ltx_text ltx_font_typewriter">BatchTaskIterationCallback</span> is executed, at each control
point <span class="ltx_text ltx_font_typewriter">BatchTaskRelaxCallback</span> is
run, and at the end of each task <span class="ltx_text ltx_font_typewriter">SolverTaskCleanup</span> is called.
<span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> and <span class="ltx_text ltx_font_typewriter">SolverTaskCleanup</span> are passed the arguments
that were passed to <span class="ltx_text ltx_font_typewriter">BatchTaskRun</span>. A simple <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span>
proc could be
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
proc SolverTaskInit { args } {
   global mif basename outtextfile
   set A [lindex $args 0]
   set outbasename "$basename-A$A"
   $mif SetA $A
   $mif SetOutBaseName $outbasename
   set outtextfile [open "$outbasename.odt" "a+"]
   puts $outtextfile [GetTextData header \
         "Run on $basename.mif, with A=[$mif GetA]"]
}
</pre>
</blockquote>
<p class="ltx_p">This proc receives the exchange constant <span class="ltx_text ltx_font_typewriter">A</span>
for this task on the argument list, and makes use of the global
variables <span class="ltx_text ltx_font_typewriter">mif</span> and <span class="ltx_text ltx_font_typewriter">basename</span>. (Both should be initialized in
the slave initialization script outside the <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> proc.)
It then stores the requested value of <span class="ltx_text ltx_font_typewriter">A</span> in the
<span class="ltx_text ltx_font_typewriter">mif</span> object, sets up the base filename to use for
output, and opens a text file to which tabular
data will be appended. The handle to this text
file is stored in the global <span class="ltx_text ltx_font_typewriter">outtextfile</span>, which is closed by the
default <span class="ltx_text ltx_font_typewriter">SolverTaskCleanup</span> proc. A corresponding task script could
be
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo AppendTask "A=13e-12 J/m" "BatchTaskRun 13e-12"
</pre>
</blockquote>
<p class="ltx_p">which runs a simulation with <span class="ltx_text ltx_font_typewriter">A</span> set to
<math id="SSS3.p2.m1" class="ltx_Math" alttext="13\times 10^{-12}" display="inline"><mrow><mn>13</mn><mo>×</mo><msup><mn>10</mn><mrow><mo>-</mo><mn>12</mn></mrow></msup></mrow></math> J/m.
This example is taken from the <span class="ltx_text ltx_font_typewriter">multitask.tcl</span>
<a href="#sec:batchschedex" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">sample script</a>. (For
commands accepted by <span class="ltx_text ltx_font_typewriter">mif</span> objects, see the file <span class="ltx_text ltx_font_typewriter">mmsinit.cc</span>.
Another object than can be gainfully manipulated is <span class="ltx_text ltx_font_typewriter">solver</span>, which
is defined in <span class="ltx_text ltx_font_typewriter">solver.tcl</span>.)</p>
</div>
<div id="SSS3.p3" class="ltx_para">
<p class="ltx_p">If you want to run more than one task at a time, then the
<span class="ltx_text ltx_font_typewriter">$TaskInfo</span> method <span class="ltx_text ltx_font_typewriter">AppendSlave</span> will have to be invoked. This
takes the form
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo AppendSlave &lt;spawn count&gt; &lt;spawn command&gt;
</pre>
</blockquote>
<p class="ltx_p">where <span class="ltx_text ltx_font_typewriter">&lt;spawn command&gt;</span> is the command to launch the slave
process, and <span class="ltx_text ltx_font_typewriter">&lt;spawn count&gt;</span> is the number of slaves to launch
with this command. (Typically <span class="ltx_text ltx_font_typewriter">&lt;spawn count&gt;</span> should not be
larger than the number of processors on the target system.) The default
value for this item (which gets overwritten with the first call to
<span class="ltx_text ltx_font_typewriter">$TaskInfo AppendSlave</span>) is
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
 1 {Oc_Application Exec batchslave -tk 0 %connect_info batchsolve.tcl}
</pre>
</blockquote>
<p class="ltx_p">The Tcl command <span class="ltx_text ltx_font_typewriter">Oc_Application Exec</span> is supplied by OOMMF and provides access to the same application-launching capability
that is used by the OOMMF <a href="sec_cll.html" title="Chapter 5 Command Line Launching ‣ OOMMF User’s Guide" class="ltx_ref">bootstrap application</a>. Using a <span class="ltx_text ltx_font_typewriter">&lt;spawn command&gt;</span> of
<span class="ltx_text ltx_font_typewriter">Oc_Application Exec</span> instead of <span class="ltx_text ltx_font_typewriter">exec %tclsh %oommf</span>
saves the spawning of an additional process.
The default <span class="ltx_text ltx_font_typewriter">&lt;spawn command&gt;</span>
launches the <span class="ltx_text ltx_font_bold">batchslave</span>
application, with connection information provided by <span class="ltx_text ltx_font_bold">batchmaster</span>, and
using the <span class="ltx_text ltx_font_typewriter">auxscript</span> <span class="ltx_text ltx_font_typewriter">batchsolve.tcl</span>.</p>
</div>
<div id="SSS3.p4" class="ltx_para">
<p class="ltx_p">Before evaluating the <span class="ltx_text ltx_font_typewriter">&lt;spawn command&gt;</span>, <span class="ltx_text ltx_font_bold">batchmaster</span>
applies several percent-style substitutions useful in slave
launch scripts: %tclsh, %oommf, %connect_info, %oommf_root, and
%%. The first is the Tcl shell to use, the second is an absolute
path to the OOMMF bootstrap program on the master machine, the third
is connection information needed by the <span class="ltx_text ltx_font_typewriter">batchslave</span> application, the
fourth is the path to the OOMMF root directory on the master machine,
and the last is interpreted as a single percent.
<span class="ltx_text ltx_font_bold">batchmaster</span> automatically appends the argument
<span class="ltx_text ltx_font_typewriter">&amp;</span> to the
<span class="ltx_text ltx_font_typewriter">&lt;spawn command&gt;</span> so that the slave applications
are launched in the background.</p>
</div>
<div id="SSS3.p5" class="ltx_para">
<p class="ltx_p">To launch <span class="ltx_text ltx_font_bold">batchslave</span> on a remote host, use <span class="ltx_text ltx_font_typewriter">ssh</span>
in the spawn command, e.g.,
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo AppendSlave 1 {exec ssh foo tclsh oommf/oommf.tcl \
      batchslave -tk 0 %connect_info batchsolve.tcl}
</pre>
</blockquote>
<p class="ltx_p">This example assumes <span class="ltx_text ltx_font_typewriter">tclsh</span> is in the execution path on the remote
machine <span class="ltx_text ltx_font_typewriter">foo</span>, and OOMMF is installed off of your home directory.
In addition, you will have to add the machine <span class="ltx_text ltx_font_typewriter">foo</span> to the host
connect list with
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
$TaskInfo ModifyHostList +foo
</pre>
</blockquote>
<p class="ltx_p">and <span class="ltx_text ltx_font_typewriter">batchmaster</span> must be run with the network interface specified
as the server host (instead of the default <span class="ltx_text ltx_font_typewriter">localhost</span>), e.g.,
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchmaster multitask.tcl bar
</pre>
</blockquote>
<p class="ltx_p">where <span class="ltx_text ltx_font_typewriter">bar</span> is the name of the local machine.</p>
</div>
<div id="SSS3.p6" class="ltx_para">
<p class="ltx_p">This may seem a bit complicated, but the examples in the
next section should make things clearer.</p>
</div>
</section>
<section id="sec:batchschedex" class="ltx_subsubsection">
<h2 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">10.2.2.4 </span>Sample task scripts</h2>

<div id="SSS4.p1" class="ltx_para">
<p class="ltx_p">The
<a name="PTbatchschedsimpletask" id="PTbatchschedsimpletask" class="ltx_anchor"></a>
<a href="#fig:batchschedsimpletask" title="Figure 10.1 ‣ 10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">first sample task script</a> is a simple example that runs the
3 micromagnetic simulations described by the MIF 1.x files
<span class="ltx_text ltx_font_typewriter">taskA.mif</span>, <span class="ltx_text ltx_font_typewriter">taskB.mif</span> and <span class="ltx_text ltx_font_typewriter">taskC.mif</span>. It
is launched with the command
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchmaster simpletask.tcl
</pre>
</blockquote>
<p class="ltx_p">This example uses the default slave launch script, so a single slave is
launched on the current machine, and the 3 simulations will be run
sequentially. Also, no slave initialization script is given, so the
default procs in <span class="ltx_text ltx_font_typewriter">batchsolve.tcl</span> are used. Output will be magnetization
states and tabular data
at each control point, stored in
files on the local machine with base names as specified in the MIF files.</p>
</div>
<figure id="fig:batchschedsimpletask" class="ltx_figure">
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 10.1: </span>Sample task script
<span class="ltx_text ltx_font_typewriter">simpletask.tcl</span>.
<a href="#PTbatchschedsimpletask" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">(description)</a></figcaption>
<p class="ltx_p">hyperlink</p>
<pre class="ltx_verbatim ltx_font_typewriter">
# FILE: simpletask.tcl
#
# This is a sample batch task file.  Usage example:
#
#   tclsh oommf.tcl batchmaster simpletask.tcl
#
# Form task list
$TaskInfo AppendTask A "BatchTaskRun taskA.mif"
$TaskInfo AppendTask B "BatchTaskRun taskB.mif"
$TaskInfo AppendTask C "BatchTaskRun taskC.mif"
</pre>
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
</figure>
<div id="SSS4.p2" class="ltx_para">
<p class="ltx_p"><a name="PTbatchoctrltask" id="PTbatchoctrltask" class="ltx_anchor"></a>
<a href="#fig:batchoctrltask" title="Figure 10.2 ‣ 10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">second sample task script</a> builds on the previous example by
defining <span class="ltx_text ltx_font_typewriter">BatchTaskIterationCallback</span> and
<span class="ltx_text ltx_font_typewriter">BatchTaskRelaxCallback</span> procedures in the slave init script.
The first set up to write tabular data every 10 iterations, while the
second writes tabular data on each control point event. The data is
written to the output file specified by the <span class="ltx_text ltx_font_typewriter">Base Output Filename</span>
entry in the input MIF files. Note that there is no magnetization
vector field output in this example. This task script is launched the
same way as the previous example:
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchmaster octrltask.tcl
</pre>
</blockquote>
</div>
<figure id="fig:batchoctrltask" class="ltx_figure">
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 10.2: </span>Task script with
iteration output <span class="ltx_text ltx_font_typewriter">octrltask.tcl</span>.
<a href="#PTbatchoctrltask" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">(description)</a></figcaption><pre class="ltx_verbatim ltx_font_typewriter">
# FILE: octrltask.tcl
#
# This is a sample batch task file, with expanded output control.
# Usage example:
#
#        tclsh oommf.tcl batchmaster octrltask.tcl
#
# "Every" output selection count
set SKIP_COUNT 10

# Initialize solver. This is run at global scope
set init_script {
    # Text output routine
    proc MyTextOutput {} {
        global outtextfile
        puts $outtextfile [GetTextData data]
        flush $outtextfile
    }
    # Change control point output
    proc BatchTaskRelaxCallback {} {
        MyTextOutput
    }
    # Add output on iteration events
    proc BatchTaskIterationCallback {} {
        global solver
        set count [$solver GetODEStepCount]
        if { ($count % __SKIP_COUNT__) == 0 } { MyTextOutput }
    }
}

# Substitute $SKIP_COUNT in for __SKIP_COUNT__ in above "init_script"
regsub -all -- __SKIP_COUNT__ $init_script $SKIP_COUNT init_script
$TaskInfo SetSlaveInitScript $init_script

# Form task list
$TaskInfo AppendTask A "BatchTaskRun taskA.mif"
$TaskInfo AppendTask B "BatchTaskRun taskB.mif"
$TaskInfo AppendTask C "BatchTaskRun taskC.mif"
</pre>
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
</figure>
<div id="SSS4.p3" class="ltx_para">
<p class="ltx_p">The
<a name="PTbatchschedmultitask" id="PTbatchschedmultitask" class="ltx_anchor"></a>
<a href="#fig:batchschedmultitask" title="Figure 10.3 ‣ 10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">third task script</a> is a more complicated example
running concurrent processes on two
machines. This script should be run with the command
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
tclsh oommf.tcl batchmaster multitask.tcl bar
</pre>
</blockquote>
<p class="ltx_p">where <span class="ltx_text ltx_font_typewriter">bar</span> is the name of the local machine.</p>
</div>
<div id="SSS4.p4" class="ltx_para">
<p class="ltx_p">Near the top of the <span class="ltx_text ltx_font_typewriter">multitask.tcl</span> script several Tcl variables
(<span class="ltx_text ltx_font_typewriter">RMT_MACHINE</span> through <span class="ltx_text ltx_font_typewriter">A_list</span>) are defined; these are used
farther down in the script. The remote machine is specified as
<span class="ltx_text ltx_font_typewriter">foo</span>, which is used in the <span class="ltx_text ltx_font_typewriter">$TaskInfo AppendSlave</span> and
<span class="ltx_text ltx_font_typewriter">$TaskInfo ModifyHostList</span> commands.</p>
</div>
<div id="SSS4.p5" class="ltx_para">
<p class="ltx_p">There are two <span class="ltx_text ltx_font_typewriter">AppendSlave</span> commands, one to run two slaves on the
local machine, and one to run a single slave on the remote machine
(<span class="ltx_text ltx_font_typewriter">foo</span>). The latter changes to a specified
working directory before
launching the <span class="ltx_text ltx_font_typewriter">batchslave</span> application on the remote machine. (For
this to work you must have <span class="ltx_text ltx_font_typewriter">ssh</span> configured properly.)</p>
</div>
<div id="SSS4.p6" class="ltx_para">
<p class="ltx_p">Below this the slave initialization script is defined. The Tcl <span class="ltx_text ltx_font_typewriter">regsub</span> command is used to place the task script defined value of
<span class="ltx_text ltx_font_typewriter">BASEMIF</span> into the init script template. The init script is run on
the slave when the slave is first brought up. It first reads the base
MIF file into a newly created <span class="ltx_text ltx_font_typewriter">mms_mif</span> instance. (The MIF file
needs to be accessible by the slave process, irrespective of which
machine it is running on.) Then replacement <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> and
<span class="ltx_text ltx_font_typewriter">SolverTaskCleanup</span> procs are defined. The new <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span>
interprets its first argument as a value for the exchange constant
<span class="ltx_text ltx_font_typewriter">A</span>. Note that this is different from the default
<span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> proc, which interprets its first argument as the
name of a MIF 1.x file to load. With this task
script, a MIF file is read once when the slave is brought up, and then
each task redefines only the value of <span class="ltx_text ltx_font_typewriter">A</span> for the simulation (and
corresponding changes to the output filenames and data table header).</p>
</div>
<div id="SSS4.p7" class="ltx_para">
<p class="ltx_p">Finally, the Tcl loop structure
</p>
<blockquote class="ltx_quote">
<pre class="ltx_verbatim ltx_font_typewriter">
foreach A $A_list {
    $TaskInfo AppendTask "A=$A" "BatchTaskRun $A"
}
</pre>
</blockquote>
<p class="ltx_p">is used to build up a task list consisting of one task for each value
of <span class="ltx_text ltx_font_typewriter">A</span> in <span class="ltx_text ltx_font_typewriter">A_list</span> (defined at the top of the task script). For
example, the first value of <span class="ltx_text ltx_font_typewriter">A</span> is 10e-13, so the first task
will have the label <span class="ltx_text ltx_font_typewriter">A=10e-13</span> and the corresponding script is
<span class="ltx_text ltx_font_typewriter">BatchTaskRun 10e-13</span>. The value 10e-13 is passed on by
<span class="ltx_text ltx_font_typewriter">BatchTaskRun</span> to the <span class="ltx_text ltx_font_typewriter">SolverTaskInit</span> proc, which has been
redefined to process this argument as the value for <span class="ltx_text ltx_font_typewriter">A</span>, as
described above.</p>
</div>
<div id="SSS4.p8" class="ltx_para">
<p class="ltx_p">There are 6 tasks in all, and 3 slave processes, so the first three
tasks will run concurrently in the 3 slaves. As each slave finishes
it will be given the next task, until all the tasks are complete.</p>
</div>
<figure id="fig:batchschedmultitask" class="ltx_figure">
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 10.3: </span>Advanced sample task
script <span class="ltx_text ltx_font_typewriter">multitask.tcl</span>.
<a href="#PTbatchschedmultitask" title="10.2.2.4 Sample task scripts ‣ 10.2.2 2D Micromagnetic Solver Batch Scheduling System ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref">(description)</a></figcaption><pre class="ltx_verbatim ltx_font_typewriter">
# FILE: multitask.tcl
#
# This is a sample batch task file.  Usage example:
#
#   tclsh oommf.tcl batchmaster multitask.tcl hostname [port]
#
# Task script configuration
set RMT_MACHINE   foo
set RMT_TCLSH      tclsh
set RMT_OOMMF      "/path/to/oommf/oommf.tcl"
set RMT_WORK_DIR   "/path/to/oommf/app/mmsolve/data"
set BASEMIF taskA
set A_list { 10e-13 10e-14 10e-15 10e-16 10e-17 10e-18 }

# Slave launch commands
$TaskInfo ModifyHostList +$RMT_MACHINE
$TaskInfo AppendSlave 2 "exec %tclsh %oommf batchslave -tk 0 \
        %connect_info batchsolve.tcl"
$TaskInfo AppendSlave 1 "exec ssh $RMT_MACHINE \
        cd $RMT_WORK_DIR \\\;\
        $RMT_TCLSH $RMT_OOMMF batchslave -tk 0 %connect_info batchsolve.tcl"

# Slave initialization script (with batchsolve.tcl proc
# redefinitions)
set init_script {
    # Initialize solver. This is run at global scope
    set basename __BASEMIF__      ;# Base mif filename (global)
    mms_mif New mif
    $mif Read [FindFile ${basename}.mif]
    # Redefine TaskInit and TaskCleanup proc’s
    proc SolverTaskInit { args } {
        global mif outtextfile basename
        set A [lindex $args 0]
        set outbasename "$basename-A$A"
        $mif SetA $A
        $mif SetOutBaseName $outbasename
        set outtextfile [open "$outbasename.odt" "a+"]
        puts $outtextfile [GetTextData header \
                "Run on $basename.mif, with A=[$mif GetA]"]
        flush $outtextfile
    }
    proc SolverTaskCleanup { args } {
        global outtextfile
        close $outtextfile
    }
}
# Substitute $BASEMIF in for __BASEMIF__ in above script
regsub -all -- __BASEMIF__ $init_script $BASEMIF init_script
$TaskInfo SetSlaveInitScript $init_script

# Create task list
foreach A $A_list {
    $TaskInfo AppendTask "A=$A" "BatchTaskRun $A"
}
</pre>
<p class="ltx_p ltx_align_center"><span class="ltx_rule" style="width:469.8pt;height:2.2pt;position:relative; bottom:4.3pt;background:black;display:inline-block;"> </span></p>
</figure>
</section>
</section>
</div>
<footer class="ltx_page_footer">
<div>
<a href="sec_batchsolve.html" title="10.2.1 2D Micromagnetic Solver Batch Interface: batchsolve ‣ 10.2 OOMMF 2D Micromagnetic Solver Batch System ‣ Chapter 10 The 2D Micromagnetic Solver ‣ OOMMF User’s Guide" class="ltx_ref" rel="prev"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10.2.1 </span>2D Micromagnetic Solver Batch Interface: batchsolve</span></a><a href="sec_mmdatatable.html" title="Chapter 11 Data Table Display: mmDataTable ‣ OOMMF User’s Guide" class="ltx_ref" rel="next"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">11 </span>Data Table Display: mmDataTable</span></a><a href="index.html" title="Index ‣ OOMMF User’s Guide" class="ltx_ref" rel="index"><span class="ltx_text ltx_ref_title">Index</span></a>
</div></footer>
</div>
</body>
</html>
